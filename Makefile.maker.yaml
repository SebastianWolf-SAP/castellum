# Configuration file for <https://github.com/sapcc/go-makefile-maker>

metadata:
  url: https://github.com/sapcc/castellum

binaries:
  - name:        castellum
    fromPackage: .
    installTo:   bin/
  - name:        castellum-netapp-scout
    fromPackage: ./cmd/netapp-scout
    installTo:   bin/

coverageTest:
  only: '/internal'
  except: '/plugins|/test'

variables:
  GO_TESTENV: 'CASTELLUM_AUDIT_SILENT=true'

vendoring:
  enabled: true

dockerfile:
  enabled: true

golangciLint:
  createConfig: true

githubWorkflow:
  global:
    assignees:
      - majewsky
      - SuperSandro2000
    ignorePaths: [ "**.md" ] # all Markdown files
  ci:
    enabled: true
    coveralls: true
    postgres:
      enabled: true
  license:
    enabled: true
  securityChecks:
    enabled: true
  spellCheck:
    enabled: true
    ignorePaths: [] # override global setting so that nothing is ignored

renovate:
  enabled: true
  packageRules:
    # do not try to update to Postgres > 12 (the tests should match what we use in production)
    - matchPackageNames: [ postgres ]
      allowedVersions: '12'

verbatim: |
  # convenience targets for developers: `make run-api/run-collector/run-worker/test-asset-type-*`
  # runs one of the components, with environment options sourced from $PWD/.env; and resource
  # configuration optionally sourced from $PWD/test-config-$ASSET_TYPE.json
  run-%: build/castellum
    set -euo pipefail && source ./.env && ./build/castellum $*
  test-asset-type-%: build/castellum
    set -euo pipefail && source ./.env && ./build/castellum test-asset-type $* "$$(test -f "test-config-$*.json" && cat "test-config-$*.json")"
